<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gestión de Salas</title>
</h:head>

<h:body>
    <!-- Formulario de búsqueda -->
    <h:form id="frmBusqueda">
        <p:outputLabel for="txtBusqueda" value="Buscar por nombre: "/>
        <p:inputText id="txtBusqueda" value="#{frmSala.registro.nombre}" size="30"/>
        <p:commandButton value="Buscar" action="#{frmSala.buscarPorNombre(frmSala.registro.nombre)}"
                         update="tablaSalas"/>
    </h:form>

    <!-- Tabla de Salas -->
    <h:form id="frmTabla">
        <p:dataTable id="tablaSalas" value="#{frmSala.registros}" var="sala"
                     paginator="true" rows="5" selectionMode="single"
                     selection="#{frmSala.registro}" rendered="#{not empty frmSala.registros}">

            <p:ajax event="rowSelect" listener="#{frmSala.seleccionarSala(sala)}" update=":frmDetalle :frmTabla"/>

            <p:column headerText="ID">
                <h:outputText value="#{sala.idSala}"/>
            </p:column>

            <p:column headerText="Nombre">
                <h:outputText value="#{sala.nombre}"/>
            </p:column>

            <p:column headerText="Sucursal">
                <h:outputText value="#{sala.idSucursal.nombre}"/>
            </p:column>

            <p:column headerText="Activo">
                <h:outputText value="#{sala.activo ? 'ACTIVO' : 'INACTIVO'}"/>
            </p:column>

            <p:column headerText="Observaciones">
                <h:outputText value="#{sala.observaciones}"/>
            </p:column>
        </p:dataTable>

        <!-- Botones de control -->
        <h:panelGrid columns="2">
            <p:commandButton value="Nuevo" action="#{frmSala.nuevaSala}" update=":frmTabla :pnlDetalle"/>
            <p:commandButton value="Cancelar" rendered="#{not empty frmSala.registro}"
                             action="#{frmSala.cancelar}" update=":frmTabla :pnlDetalle"/>
        </h:panelGrid>
    </h:form>

    <!-- Detalles de la Sala seleccionada -->
    <h:panelGroup id="pnlDetalle">
        <p:tabView id="tabDetalle" rendered="#{not empty frmSala.registro}" cache="false">
            <p:tab title="Generalidades">
                <h:form id="frmDetalle">
                    <h:panelGrid columns="2">
                        <p:outputLabel value="ID" for="txtId"/>
                        <p:inputText id="txtId" value="#{frmSala.registro.idSala}" readonly="true"/>

                        <p:outputLabel value="Nombre" for="txtNombre"/>
                        <p:inputText id="txtNombre" value="#{frmSala.registro.nombre}" size="70"/>

                        <p:outputLabel value="Activo" for="chkActivo"/>
                        <p:selectBooleanCheckbox id="chkActivo" value="#{frmSala.registro.activo}"/>

                        <p:outputLabel value="Observaciones" for="txtObservaciones"/>
                        <p:inputText id="txtObservaciones" value="#{frmSala.registro.observaciones}" size="70"/>
                    </h:panelGrid>

                    <h:panelGrid columns="3">
                        <p:commandButton value="Guardar" action="#{frmSala.guardarSala}"
                                         update=":frmTabla :pnlDetalle"/>

                        <p:commandButton value="Modificar" rendered="#{not empty frmSala.registro.idSala}"
                                         action="#{frmSala.guardarSala}" update=":frmTabla :pnlDetalle"/>
                        <p:commandButton value="Eliminar" rendered="#{not empty frmSala.registro.idSala}"
                                         action="#{frmSala.eliminarSala}" update=":frmTabla :pnlDetalle"/>
                    </h:panelGrid>
                </h:form>
            </p:tab>

            <!-- Info de la Sucursal -->
            <p:tab title="Info Sucursal" rendered="#{not empty frmSala.registro}">
                <h:form id="frmSucursalDetalle">
                    <h:panelGrid columns="2">
                        <p:outputLabel value="Sucursal" for="ddlSucursal"/>
                        <p:selectOneMenu id="ddlSucursal" value="#{frmSala.registro.idSucursal.idSucursal}">
                            <f:selectItem itemValue="0" itemLabel="Seleccione una Sucursal"/>
                            <f:selectItems value="#{frmSala.sucursales}" var="sucursal"
                                           itemLabel="#{sucursal.nombre}" itemValue="#{sucursal.idSucursal}"/>
                        </p:selectOneMenu>

                        <p:outputLabel value="Latitud" for="txtLatitud"/>
                        <p:inputText id="txtLatitud" value="#{frmSala.registro.idSucursal.latitud}" size="70"/>

                        <p:outputLabel value="Longitud" for="txtLongitud"/>
                        <p:inputText id="txtLongitud" value="#{frmSala.registro.idSucursal.longitud}" size="70"/>
                    </h:panelGrid>
                </h:form>
            </p:tab>

            <!-- Tab de Películas -->
            <p:tab title="Películas" rendered="#{not empty frmSala.registro}">
                <p:dataTable value="#{frmSala.registro.programacionList}" var="programacion">
                    <p:column headerText="Título">
                        <h:outputText value="#{programacion.idPelicula.titulo}"/>
                    </p:column>
                    <p:column headerText="Duración">
                        <h:outputText value="#{programacion.idPelicula.duracion}"/>
                    </p:column>
                </p:dataTable>
            </p:tab>
        </p:tabView>
    </h:panelGroup>

</h:body>
</html>
